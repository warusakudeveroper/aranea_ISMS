# ğŸ”´ P0 ç·Šæ€¥ãƒã‚°ãƒ¬ãƒãƒ¼ãƒˆ: Schema API æœªå®Ÿè£…

**å ±å‘Šæ—¥**: 2025-12-26
**å ±å‘Šè€…**: aranea_ISMSé–‹ç™ºãƒãƒ¼ãƒ 
**å„ªå…ˆåº¦**: P0 (Critical) - **ã“ã‚Œã˜ã‚ƒä½¿ãˆã­ãƒ¼ã**
**ç™ºè¦‹æ–¹æ³•**: aranea-sdk-cli è©³ç´°ãƒ†ã‚¹ãƒˆ

---

## çµè«–

**Schema APIãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ã€‚CLIã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¦ã„ã‚‹ã ã‘ã€‚**

---

## å•é¡Œã®æ·±åˆ»åº¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   ã€ŒSDK 80%å®Œæˆã€ã¨å ±å‘Šã•ã‚ŒãŸãŒã€å®Ÿæ…‹ã¯ä½¿ã„ç‰©ã«ãªã‚‰ãªã„     â”‚
â”‚                                                             â”‚
â”‚   - Schema API: 404 (å­˜åœ¨ã—ãªã„)                            â”‚
â”‚   - CLI schema get: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ€ãƒŸãƒ¼ã‚’è¿”ã™          â”‚
â”‚   - Schemaæ›´æ–°æ©Ÿèƒ½: å­˜åœ¨ã—ãªã„                              â”‚
â”‚                                                             â”‚
â”‚   é–‹ç™ºè€…ã¯ã“ã®SDKã§ä½•ã‚’é–‹ç™ºã™ã‚Œã°ã„ã„ã®ã‹ï¼Ÿ                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¤œè¨¼çµæœ

### 1. Schema API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

```bash
$ curl -s "https://asia-northeast1-mobesorder.cloudfunctions.net/araneaSchemaAPI"

<html>
<title>404 Page not found</title>
<h1>Error: Page not found</h1>
</html>
```

**â†’ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå­˜åœ¨ã—ãªã„**

### 2. CLI ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è§£æ

`aranea-sdk-cli/dist/commands/schema.js`:

```javascript
// 19è¡Œç›® - ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ€ãƒŸãƒ¼ã‚¹ã‚­ãƒ¼ãƒ
const BUILTIN_SCHEMAS = {
    'aranea_ar-is04a': {
        displayName: 'Network Scanner',  // â† é–“é•ã„ã€‚å®Ÿéš›ã¯Window & Door Controller
        stateFields: {
            scanMode: { ... },           // â† å­˜åœ¨ã—ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            discoveredHosts: { ... },    // â† å­˜åœ¨ã—ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        }
    },
    'aranea_ar-is05a': {
        displayName: 'Environment Sensor', // â† é–“é•ã„ã€‚å®Ÿéš›ã¯8-Channel Detector
        stateFields: {
            temperature: { ... },         // â† å­˜åœ¨ã—ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            humidity: { ... },            // â† å­˜åœ¨ã—ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        }
    }
}
```

**â†’ Firestoreã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ãªã„ã€‚ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿**

### 3. æ­£ã—ã„ã‚¹ã‚­ãƒ¼ãƒã¨ã®æ¯”è¼ƒ

| Type | CLIãŒè¿”ã™å†…å®¹ | å®Ÿéš›ã®ãƒ‡ãƒã‚¤ã‚¹ |
|------|--------------|---------------|
| is04a | Network Scanner (scanMode, discoveredHosts) | **Window & Door Controller** (output1, output2, input1, input2) |
| is05a | Environment Sensor (temperature, humidity) | **8-Channel Detector** (channels[8]) |
| is06a | Power Monitor (voltage, current) | **6ch Output Controller** |

**â†’ å…¨ãåˆ¥ã®ãƒ‡ãƒã‚¤ã‚¹å®šç¾©**

---

## å½±éŸ¿

### é–‹ç™ºè€…ã¸ã®å½±éŸ¿

1. **é–“é•ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã—ã¾ã†**: ã‚¹ã‚­ãƒ¼ãƒã‚’ä¿¡ã˜ã¦ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¨å‹•ã‹ãªã„
2. **validate ãŒæ©Ÿèƒ½ã—ãªã„**: æ­£ã—ã„ãƒ‡ãƒ¼ã‚¿ãŒã€Œä¸æ­£ã€ã¨åˆ¤å®šã•ã‚Œã‚‹
3. **simulate ãŒç„¡æ„å‘³**: é–“é•ã£ãŸã‚µãƒ³ãƒ—ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹
4. **æ–°è¦ãƒ‡ãƒã‚¤ã‚¹é–‹ç™ºä¸å¯èƒ½**: ã‚¹ã‚­ãƒ¼ãƒã‚’ç™»éŒ²ã™ã‚‹æ‰‹æ®µãŒãªã„

### å ±å‘Šã¨ã®ä¹–é›¢

| mobeså ±å‘Š | å®Ÿæ…‹ |
|-----------|------|
| Schema API å®Ÿè£…æ¸ˆã¿ | âŒ 404 (å­˜åœ¨ã—ãªã„) |
| CLI schema get å‹•ä½œ | âš ï¸ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰è¿”å´ |
| é€²æ— 80% | â“ åŸºå¹¹æ©Ÿèƒ½ãŒæœªå®Ÿè£… |

---

## å¿…è¦ãªå®Ÿè£…

### å³åº§ã«å¿…è¦ (P0)

1. **araneaSchemaAPI Cloud Function ä½œæˆ**
   ```
   GET  /araneaSchemaAPI?type=xxx     â†’ ã‚¹ã‚­ãƒ¼ãƒå–å¾—
   POST /araneaSchemaAPI              â†’ ã‚¹ã‚­ãƒ¼ãƒæ›´æ–°
   GET  /araneaSchemaAPI/list         â†’ ä¸€è¦§å–å¾—
   ```

2. **Firestore typeSettings æ§‹é€ **
   ```
   typeSettings/
   â””â”€â”€ araneaDevice/
       â”œâ”€â”€ aranea_ar-is04a    â† ã“ã“ã«ã‚¹ã‚­ãƒ¼ãƒã‚’ä¿å­˜
       â”œâ”€â”€ aranea_ar-is05a
       â””â”€â”€ ...
   ```

3. **CLI ã®ä¿®æ­£**
   - `BUILTIN_SCHEMAS` ã‚’å‰Šé™¤
   - APIçµŒç”±ã§Firestoreã‹ã‚‰å–å¾—
   - `schema update` ã‚³ãƒãƒ³ãƒ‰è¿½åŠ 

### æ­£ã—ã„ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Firestoreã«ç™»éŒ²ã™ã‚‹ã“ã¨:

```
aranea_ISMS/araneaSDK/schemas/types/
â”œâ”€â”€ aranea_ar-is01.json
â”œâ”€â”€ aranea_ar-is04a.json   â† æ­£ã—ã„å®šç¾©
â”œâ”€â”€ aranea_ar-is05a.json   â† æ­£ã—ã„å®šç¾©
â”œâ”€â”€ aranea_ar-is06a.json
â””â”€â”€ aranea_ar-is10.json
```

---

## æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰

ä¿®æ­£å¾Œã€ä»¥ä¸‹ã§ç¢ºèª:

```bash
# API ãŒå‹•ä½œã™ã‚‹ã“ã¨
$ curl "https://asia-northeast1-mobesorder.cloudfunctions.net/araneaSchemaAPI?type=aranea_ar-is04a"
# â†’ JSON ãŒè¿”ã‚‹ (HTMLã§ã¯ãªã)

# CLI ãŒFirestoreã‹ã‚‰å–å¾—ã™ã‚‹ã“ã¨
$ aranea-sdk schema get --type aranea_ar-is04a
# â†’ displayName: "Window & Door Controller"
# â†’ stateFields: output1, output2, input1, input2

# ã‚¹ã‚­ãƒ¼ãƒæ›´æ–°ãŒã§ãã‚‹ã“ã¨
$ aranea-sdk schema update --type aranea_ar-is04a --file ./schemas/types/aranea_ar-is04a.json
```

---

## å³é‡æŠ—è­°

1. **ã€Œ80%å®Œæˆã€ã¨ã„ã†å ±å‘Šã¯ä½•ã‚’æ ¹æ‹ ã«ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿ**
   - Schema APIãŒå­˜åœ¨ã—ãªã„çŠ¶æ…‹ã§80%ã¨ã¯è¨€ãˆãªã„

2. **CLIãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™ã®ã¯è©æ¬ºçš„**
   - é–‹ç™ºè€…ã¯APIã‹ã‚‰å–å¾—ã—ã¦ã„ã‚‹ã¨æ€ã£ã¦ä½¿ã†
   - å®Ÿéš›ã¯é–“é•ã£ãŸãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿

3. **ãƒ‡ãƒã‚¤ã‚¹é–‹ç™ºãŒå®Œå…¨ã«ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹**
   - æ–°ã—ã„Typeã‚’ç™»éŒ²ã§ããªã„
   - æ—¢å­˜Typeã®ã‚¹ã‚­ãƒ¼ãƒã‚‚æ›´æ–°ã§ããªã„
   - SDKã¨ã—ã¦æœ€ä½é™ã®æ©Ÿèƒ½ãŒæ¬ è½

4. **ãƒ†ã‚¹ãƒˆãƒ†ãƒŠãƒ³ãƒˆãƒ»èªè¨¼æƒ…å ±ã®æ•´å‚™ã‚ˆã‚Šã‚‚å…ˆã«ã“ã‚Œã‚’ç›´ã™ã¹ã**
   - èªè¨¼ãŒé€šã£ã¦ã‚‚ã‚¹ã‚­ãƒ¼ãƒãŒãªã„ã¨æ„å‘³ãŒãªã„

---

## æœŸé™

**2025-12-27 ã¾ã§ã«ä»¥ä¸‹ã‚’å®Œäº†ã™ã‚‹ã“ã¨:**

- [ ] araneaSchemaAPI ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½œæˆ
- [ ] Firestore typeSettings ã«æ­£ã—ã„ã‚¹ã‚­ãƒ¼ãƒç™»éŒ²
- [ ] CLI ã® BUILTIN_SCHEMAS å‰Šé™¤
- [ ] schema update ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…

---

## é€£çµ¡å…ˆ

aranea_ISMSé–‹ç™ºãƒãƒ¼ãƒ 

**ã“ã‚ŒãŒç›´ã‚‰ãªã„é™ã‚Šã€SDKã‚’ä½¿ã£ãŸé–‹ç™ºã¯ä¸€åˆ‡ã§ãã¾ã›ã‚“ã€‚**
