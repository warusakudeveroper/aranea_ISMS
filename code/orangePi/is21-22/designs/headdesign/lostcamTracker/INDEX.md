# LostCamTracker - ドキュメントインデックス

## 概要

DHCPによるIPアドレス変更で失われたカメラを自動検出・復旧する機能。

---

## ⚠️ 重要な設計原則

**カメラに負荷をかけない**

| 方式 | カメラ負荷 | 自動実行 |
|------|-----------|----------|
| ARPスキャン | **ゼロ** | ✅ 自動 |
| ARPスキャナデバイス | **ゼロ** | ✅ 自動 |
| カメラスキャン（フル） | 高 | ❌ 手動のみ |

Tapo等の低処理性能カメラはONVIF/RTSP認証試行で一時ロストするため、
LostCamTrackerは**ARPのみ**を使用。

---

## ドキュメント一覧

| ファイル | 内容 |
|----------|------|
| [LostCamTracker_Design.md](./LostCamTracker_Design.md) | 機能設計書（メイン） |
| [ARP_Scan_Technical_Spec.md](./ARP_Scan_Technical_Spec.md) | ARPスキャン技術仕様 |

---

## 機能概要

```
┌─────────────────────────────────────────────────────────────┐
│                   LostCamTracker                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【検出】                                                   │
│  カメラ異常 (30分以上) → ロストカメラとして検出             │
│                                                             │
│  【追跡】※カメラに負荷をかけない                           │
│  ARPスキャン (L2) → MAC照合 → 新IPアドレス特定             │
│                                                             │
│  【復旧】                                                   │
│  IP自動更新 → カメラ復帰 → AI EVENT LOG出力               │
│  「IPアドレスの変更を追跡しました。XXX.XXX.XXX.XXX」       │
│                                                             │
│  【VPN越し等】                                              │
│  自動実行しない → UI通知「手動カメラスキャン推奨」         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 設定項目

| 項目 | デフォルト | 説明 |
|------|------------|------|
| 検出閾値 | 30分 | カメラ異常からARPスキャンまでの時間 |
| リトライ間隔 | 60分 | 見つからない場合の再試行間隔 |

---

## ARPスキャナデバイス形式

```json
["192.168.125.45,A842A1B95323", "192.168.126.30,DC62798D08EA"]
```

- シンプルな `"IP,MAC"` 形式の配列
- MACは正規化済み（大文字、セパレータなし）

---

## 関連Issue/PR

- 2026-01-16: MAC正規化比較修正 (ipcam_scan/mod.rs)
- 未定: LostCamTracker実装

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2026-01-16 | ドキュメント初版作成 |
| 2026-01-16 | カメラ負荷ゼロ設計原則を明記 |
