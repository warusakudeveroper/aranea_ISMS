# JOOAN A6M-U ストレステスト報告書

## テスト実施日
2026-01-17

## テスト環境

| 項目 | 値 |
|------|-----|
| カメラ | JOOAN A6M-U |
| カメラIP | 192.168.77.23 |
| テストサーバー | IS22 (192.168.125.246) |
| ONVIFポート | 8899 |
| RTSPポート | 554 |
| 認証情報 | admin:test12345 |

---

## 1. テスト結果サマリー

| テスト項目 | 結果 | 評価 |
|-----------|------|------|
| RTSP同時接続 | 不安定（3-6接続で問題発生） | ⚠️ 注意 |
| RTSP急速再接続（インターバルなし） | 1/20成功（5%） | ❌ 問題あり |
| RTSP再接続（0.5秒間隔） | 8/10成功（80%） | ⚠️ 注意 |
| RTSP再接続（2秒間隔） | 10/10成功（100%） | ✅ 良好 |
| RTSP長時間ストリーム（30秒） | 成功 | ✅ 良好 |
| RTSP Main/Sub切替 | 5/10, 4/10 | ⚠️ 注意 |
| ONVIF急速リクエスト | 20/20成功（100%） | ✅ 優秀 |
| ONVIF同時リクエスト（5並列） | 5/5成功（100%） | ✅ 優秀 |
| HTTP急速リクエスト（port 80） | 20/20成功（100%） | ✅ 優秀 |
| HTTPS急速リクエスト（port 443） | 20/20成功（100%） | ✅ 優秀 |
| HTTP同時リクエスト（10並列） | 10/10成功（100%） | ✅ 優秀 |

---

## 2. 詳細テスト結果

### 2.1 RTSP同時接続テスト

複数のRTSP接続を同時に開いてカメラの応答を確認。

| 同時接続数 | 結果 |
|-----------|------|
| 1 | ✅ 安定 |
| 2 | ✅ 安定 |
| 3 | ⚠️ 不安定 |
| 4 | ✅ 安定 |
| 5 | ✅ 安定 |
| 6 | ⚠️ 不安定 |
| 8 | ✅ 安定 |

**所見**: 同時接続数による明確な閾値は見られないが、3または6接続時に不安定になる傾向。カメラ内部のリソース競合が原因と推測。

---

### 2.2 RTSP再接続テスト

連続してRTSP接続を確立・切断した際の安定性を確認。

| インターバル | 成功率 | 詳細 |
|-------------|--------|------|
| 0秒（急速） | **5%** (1/20) | ❌ 実用不可 |
| 0.5秒 | **80%** (8/10) | ⚠️ 時折失敗 |
| 1秒 | **70%** (7/10) | ⚠️ 不安定 |
| 2秒 | **100%** (10/10) | ✅ 安定 |

**所見**:
- **急速な再接続は実用上困難**
- **最低2秒のインターバルが必要**
- Tapoと比較すると、JOOANは再接続時の安定性に劣る傾向

---

### 2.3 長時間ストリームテスト

30秒間の連続ストリーミングを実施。

```
結果: SUCCESS
フレーム数: 451フレーム
平均FPS: 約15fps
ストリーム安定性: 良好
```

**所見**: 一度接続が確立されれば安定してストリーミング可能。

---

### 2.4 Main/Sub ストリーム切替テスト

メインストリーム（2304x1296）とサブストリーム（640x360）を交互に取得。

| ストリーム | 成功率 |
|-----------|--------|
| Main (ch00_0) | 5/10 (50%) |
| Sub (ch00_1) | 4/10 (40%) |

**所見**: ストリーム切替時に接続失敗が多発。IS22でのスナップショット取得時は十分なインターバルを設ける必要あり。

---

### 2.5 RTSP応答時間

3秒インターバルでの応答時間測定。

| サンプル | 応答時間 |
|---------|---------|
| 1 | FAILED |
| 2 | 1775ms |
| 3 | 1223ms |
| 4 | 1256ms |
| 5 | 1256ms |

**平均応答時間**: 約1.4秒（成功時）

---

### 2.6 ONVIFエンドポイントテスト

ポート8899のONVIFサービスに対する負荷テスト。

| テスト | 結果 |
|-------|------|
| 急速リクエスト（20回） | 20/20成功 ✅ |
| 0.5秒インターバル（10回） | 10/10成功 ✅ |
| 同時リクエスト（5並列） | 5/5成功 ✅ |

**所見**: ONVIFエンドポイントは非常に安定。RTSPとは対照的に、高頻度アクセスにも問題なし。

---

### 2.7 HTTP/HTTPSエンドポイントテスト

| テスト | ポート | 結果 |
|-------|-------|------|
| 急速リクエスト | 80 (HTTP) | 20/20成功 ✅ |
| 急速リクエスト | 443 (HTTPS) | 20/20成功 ✅ |
| 同時リクエスト（10並列） | 80 | 10/10成功 ✅ |

**所見**: HTTP/HTTPSは完全に安定。Webインターフェースへのアクセスは問題なし。

---

## 3. Tapoとの比較

| 項目 | JOOAN A6M-U (NVT) | TP-link Tapo |
|------|-------------------|--------------|
| RTSP多重接続 | ⚠️ 3-6接続で不安定 | ⚠️ 多重接続で応答ロストあり |
| RTSP急速再接続 | ❌ 5%成功 | ⚠️ 問題報告あり |
| 推奨再接続間隔 | **2秒以上** | 未計測 |
| ONVIF安定性 | ✅ 非常に良好 | ✅ 良好 |
| HTTP安定性 | ✅ 非常に良好 | ✅ 良好 |
| 長時間ストリーム | ✅ 安定 | ⚠️ 時折切断 |

**総評**:
- JOOANはTapoと同様にRTSP再接続に弱点がある
- ONVIFとHTTPは両者とも安定
- JOOANは一度接続すれば長時間安定する傾向

---

## 4. IS22運用への推奨事項

### 4.1 スナップショット取得
```
推奨設定:
- スナップショット間隔: 最低2秒
- リトライ回数: 3回
- リトライ間隔: 2秒
```

### 4.2 ストリーム管理
```
推奨設定:
- 接続維持: 長時間接続を維持（頻繁な接続切断を避ける）
- 接続プール: 可能なら接続を再利用
- タイムアウト: 接続確立に5秒以上を許容
```

### 4.3 ポーリングスケジュール
```
推奨設定:
- ヘルスチェック間隔: 60秒以上
- ONVIFプローブ: 制限なし（安定）
- RTSPプローブ: 2秒以上のインターバル
```

### 4.4 エラーハンドリング
```
実装推奨:
- RTSP接続失敗時: 2秒待機後リトライ
- 連続失敗: 指数バックオフ（2秒 → 4秒 → 8秒）
- 最大リトライ: 5回
```

---

## 5. 結論

JOOAN A6M-U（NVT系）は以下の特性を持つ：

### 強み ✅
- ONVIFエンドポイントが非常に安定（100%成功率）
- HTTP/HTTPSエンドポイントが安定
- 一度接続すれば長時間の安定ストリーミングが可能
- 複数プロトコル同時アクセスも問題なし

### 弱み ⚠️
- **RTSP急速再接続に弱い**（最大の問題点）
- ストリーム切替時に失敗しやすい
- 接続確立に1.2〜1.8秒かかる

### IS22での利用
- **利用可能**：適切なインターバル設定（2秒以上）で安定運用可能
- **注意点**：スナップショット取得やストリーム切替は2秒以上のインターバルを設ける

---

## 付録: テストコマンド

### RTSP接続テスト
```bash
ffprobe -rtsp_transport tcp -v error -show_entries stream=width,height -of csv=p=0 \
    "rtsp://admin:test12345@192.168.77.23:554/live/ch00_0"
```

### ONVIF接続テスト
```bash
curl -s --max-time 3 -X POST \
    -H "Content-Type: application/soap+xml" \
    -d '<?xml version="1.0" encoding="UTF-8"?><s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope"><s:Body><GetDeviceInformation xmlns="http://www.onvif.org/ver10/device/wsdl"/></s:Body></s:Envelope>' \
    http://192.168.77.23:8899/onvif/device_service
```

### 長時間ストリームテスト
```bash
timeout 35 ffmpeg -rtsp_transport tcp -i "rtsp://admin:test12345@192.168.77.23:554/live/ch00_0" \
    -t 30 -f null -
```
