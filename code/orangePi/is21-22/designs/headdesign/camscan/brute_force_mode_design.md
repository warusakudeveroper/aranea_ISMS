# Brute Force Mode トグル追加 設計ドキュメント

## 1. 概要

### 1.1 目的
カメラの可能性が低いデバイス（カテゴリD/E）に対する認証試行を制御するトグルを追加し、スキャン時間の短縮を実現する。

### 1.2 対象ファイル
- バックエンド: `src/ipcam_scan/mod.rs`
- フロントエンド: `frontend/src/components/CameraScanModal.tsx`

### 1.3 現状の問題点（Camscan_designers_review.md #4より）
- D/Eカテゴリへのクレデンシャル試行は無意味なことが多い
- 全デバイスに認証試行するため、スキャンに非常に時間がかかる

---

## 2. 設計

### 2.1 トグル仕様

| 項目 | 値 |
|------|-----|
| ラベル | Brute Force Mode |
| 説明 | カメラの可能性が低い検出対象にも全認証を試行します。非常に時間がかかります。 |
| デフォルト | OFF |

### 2.2 動作定義

#### Brute Force Mode: OFF（デフォルト）
```
認証試行対象:
  ✓ RTSP応答あり (554ポート)
  ✓ ONVIF応答あり (80/443/8080)
  ✓ OUI一致 + RTSPまたはONVIFポート

認証試行スキップ:
  ✗ HTTPのみ (カテゴリD)
  ✗ 8443のみ (IoTデバイス)
  ✗ ポート応答なし (カテゴリE)
```

#### Brute Force Mode: ON
```
認証試行対象:
  ✓ 全オープンポート検出デバイス

認証試行スキップ:
  ✗ ポート応答なし（物理的に無理）
```

### 2.3 スコア閾値

```rust
/// Brute Force OFF時の認証試行対象スコア閾値
const AUTH_SCORE_THRESHOLD_NORMAL: u32 = 30;  // RTSP(30)またはONVIF(30)必須

/// Brute Force ON時の認証試行対象スコア閾値
const AUTH_SCORE_THRESHOLD_BRUTE: u32 = 5;   // 任意のポート応答で対象
```

### 2.4 API設計

```
POST /api/scan/start
{
    "subnets": ["192.168.125.0/24"],
    "brute_force_mode": false  // 新規追加
}
```

### 2.5 進捗表示への影響

Brute Force Mode: OFF時
- 認証試行対象外デバイスはスキップ
- 進捗バーがまとめて進む（設計通り）
- スキャン時間大幅短縮

---

## 3. UI設計

### 3.1 トグル配置

```
┌─────────────────────────────────────────────────┐
│ スキャン設定                                     │
├─────────────────────────────────────────────────┤
│ 対象サブネット: [192.168.125.0/24 ▼]            │
│                                                 │
│ [ ] Brute Force Mode                           │
│     カメラの可能性が低いデバイスにも認証試行     │
│     ⚠ スキャン時間が大幅に増加します            │
│                                                 │
│            [スキャン開始]                        │
└─────────────────────────────────────────────────┘
```

### 3.2 警告表示

Brute Force Mode ON時:
```
⚠ Brute Force Mode が有効です
推定スキャン時間: 約45分（通常モード: 約10分）
```

---

## 4. テスト計画

### 4.1 単体テスト
1. スコア閾値による認証対象判定テスト
2. Brute Force Mode ON/OFF切り替えテスト

### 4.2 結合テスト
1. Brute Force OFF時のスキャン時間計測
2. Brute Force ON時のスキャン時間計測
3. 認証対象数の比較

### 4.3 UIテスト
1. トグル表示確認
2. 警告メッセージ表示確認

---

## 5. MECE確認

- [x] ON/OFF状態が相互排他的
- [x] 認証対象/スキップ対象が明確に定義
- [x] デフォルト値が定義されている

---

**作成日**: 2026-01-07
**作成者**: Claude Code
**ステータス**: 設計完了・レビュー待ち
