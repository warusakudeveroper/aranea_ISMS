# IS22 モバイルビュー基本設計

**Issue**: #108
**作成日**: 2025-01-09
**ステータス**: 設計中

---

## 1. 概要

### 1.1 目的
IS22 RTSP カメラ総合管理サーバーのフロントエンドをモバイル端末（スマートフォン）で閲覧・操作可能にする。

### 1.2 対象デバイス
- **解像度**: 3200×1440px（高DPI Android想定）
- **論理解像度**: 360×800dp程度（density 4.0）
- **向き**: ポートレート（縦向き）のみ対応
- **ランドスケープ（横向き）は非対応**

### 1.3 大原則遵守
- **SSoT**: モバイル専用のデータソースは作成しない。既存APIをそのまま利用
- **SOLID**: 既存コンポーネントを拡張・条件分岐で対応。新規コンポーネントは最小限
- **MECE**: PC表示とモバイル表示の機能は漏れなく網羅
- **アンアンビギュアス**: ブレークポイント、アニメーション方向を明確に定義

---

## 2. 現状分析

### 2.1 現行PC表示レイアウト（h-screen固定）
```
┌─────────────────────────────────────────────────────┐
│ Header (h-14) - WebSocket状態 + CPU/MEM表示        │
├──────────┬─────────────────────┬────────────────────┤
│  30%     │      55%           │      15%           │
│SuggestPane│  CameraGrid (4列)  │  EventLogPane      │
│ (左)      │  + AddCameraCard   │  (右)              │
└──────────┴─────────────────────┴────────────────────┘
```

### 2.2 現行の問題点
| 項目 | 問題 |
|------|------|
| 3ペーン固定比率 | モバイルで破綻（15%ペインは48px程度） |
| 4列グリッド | モバイルで1タイルあたり90px程度で実用不可 |
| SuggestPane | 左30%ペイン常時表示はモバイルでは画面専有 |
| EventLogPane | 右15%ペインでは文字読めない |
| ブレークポイント | 未実装 |

---

## 3. モバイル表示仕様

### 3.1 画面構成（縦スクロール許容）

```
┌─────────────────────────────────────────┐
│ Header (h-14, 固定)                     │  ← PC版と共通
├─────────────────────────────────────────┤
│                                         │
│ SuggestView (画面の30%高さ)             │  ← 固定高さ領域
│ ・左からスライドイン / 上にスライドアウト │
│ ・イベント動画再生 + サジェスト表示      │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│ CameraGrid (3列, 1:1 スクエア)          │  ← スクロール領域
│ ┌────┬────┬────┐                        │
│ │Cam1│Cam2│Cam3│                        │
│ ├────┼────┼────┤                        │
│ │Cam4│Cam5│Cam6│                        │
│ ├────┼────┼────┤                        │
│ │... │... │... │                        │
│ └────┴────┴────┘                        │
│                                         │
│ [+ カメラをスキャン]                    │  ← 末尾固定
│                                         │
└─────────────────────────────────────────┘

[AI] ← フローティングボタン（スクロール追従、右下）

── 右ドロワー（AIイベントログ）──────────┐
│ AI Event Log                          │  ← スワイプor
│ ・Detection Logs                      │    ボタンで開閉
│ ・Chat UI                             │
└───────────────────────────────────────┘
```

### 3.2 レイアウト仕様詳細

| 要素 | 仕様 |
|------|------|
| **Header** | h-14 (56px)、PC版と共通、sticky top-0 |
| **SuggestView** | 画面高さの30%、固定表示（スクロール不可） |
| **CameraGrid** | 残り70%領域、内部スクロール可、3列 |
| **AIボタン** | fixed right-4 bottom-4、z-50 |
| **Drawer** | 右からスライドイン、幅85%、z-50 |

### 3.3 ブレークポイント定義

```css
/* モバイル判定 */
@media (max-width: 768px) {
  /* モバイルレイアウト適用 */
}

/* タブレット（オプション、将来対応） */
@media (min-width: 769px) and (max-width: 1024px) {
  /* タブレットレイアウト */
}

/* PC（既存レイアウト） */
@media (min-width: 1025px) {
  /* 現行レイアウトをそのまま維持 */
}
```

---

## 4. コンポーネント別設計

### 4.1 SuggestView（モバイル版）

**配置**: Header直下、固定高さ（画面30%）

**アニメーション方向**:
| 状態 | PC版 | モバイル版 |
|------|------|------------|
| 表示 | 上からスライドイン | 左からスライドイン |
| 非表示 | 左にスライドアウト | 上にスライドアウト |

**実装方針**:
- 既存 `SuggestPane.tsx` を条件分岐でアニメーション方向を変更
- `useMediaQuery` フックでブレークポイント検知

### 4.2 CameraGrid（モバイル版）

**仕様**:
| 項目 | PC版 | モバイル版 |
|------|------|------------|
| 列数 | 4列 | 3列 |
| タイル形状 | 正方形（圧縮時は縦縮小） | 1:1 固定正方形 |
| スクロール | 禁止（タイル圧縮で対応） | 縦スクロール許容 |
| DnD並べ替え | 対応 | 対応（タッチ操作） |

**タイル計算**:
```typescript
// モバイル: 固定3列、gap 8px
const MOBILE_COLS = 3
const MOBILE_GAP = 8
const tileWidth = (containerWidth - MOBILE_GAP * (MOBILE_COLS - 1)) / MOBILE_COLS
const tileHeight = tileWidth // 1:1 強制
```

### 4.3 AIイベントログドロワー

**トリガー**:
- 右下AIアイコンタップ
- 右端からスワイプ（将来対応）

**構成**:
```
┌──────────────────────────────┐
│ [×] AI Event Log        [100]│  ← Header
├──────────────────────────────┤
│ PatrolStatusTicker           │  ← パトロール状態
├──────────────────────────────┤
│ ┌──────────────────────────┐ │
│ │ Detection Logs (50%)     │ │  ← 上半分
│ │ ・イベントリスト         │ │
│ │ ・タップで詳細モーダル   │ │
│ └──────────────────────────┘ │
├──────────────────────────────┤
│ ┌──────────────────────────┐ │
│ │ Chat UI (50%)            │ │  ← 下半分
│ │ ・チャット履歴           │ │
│ │ ・サジェスト表示         │ │
│ └──────────────────────────┘ │
├──────────────────────────────┤
│ [メッセージ入力...]    [送信]│  ← ChatInput
└──────────────────────────────┘
```

### 4.4 フローティングAIボタン

**位置**: `fixed right-4 bottom-4`（スクロール追従）

**状態**:
| 状態 | 表示 |
|------|------|
| 通常 | AIアイコン |
| 新着イベント | パルスアニメーション + バッジ |
| ドロワー開 | ×アイコン |

### 4.5 モーダル類

**対象モーダル**:
- `LiveViewModal` (カメラ再生)
- `CameraDetailModal` (カメラ設定)
- `DetectionDetailModal` (検出詳細)
- `ScanModal` (カメラスキャン)
- `SettingsModal` (全体設定)

**モバイル対応**:
- `max-w-[95vw]` で画面幅に収める
- `max-h-[90vh]` で高さ制限
- 内部スクロール対応

---

## 5. 実装対象ファイル

| ファイル | 変更内容 |
|----------|----------|
| `App.tsx` | レイアウト条件分岐、useMediaQuery導入 |
| `SuggestPane.tsx` | アニメーション方向切替 |
| `CameraGrid.tsx` | 3列対応、スクロール許容 |
| `CameraTile.tsx` | タッチ操作最適化 |
| `EventLogPane.tsx` | ドロワー化、独立コンポーネント分離 |
| `index.css` | ブレークポイント定義 |
| 新規: `MobileDrawer.tsx` | ドロワーUI |
| 新規: `FloatingAIButton.tsx` | フローティングボタン |
| 新規: `hooks/useMediaQuery.ts` | ブレークポイント検知 |

---

## 6. 依存関係

```
useMediaQuery (新規)
    ↓
App.tsx (レイアウト分岐)
    ├── SuggestPane (アニメーション分岐)
    ├── CameraGrid (列数分岐)
    │   └── CameraTile (サイズ分岐)
    └── EventLogPane → MobileDrawer (モバイル時)
            ↑
    FloatingAIButton (トリガー)
```

---

## 7. MECE確認

### 7.1 機能網羅チェック

| PC機能 | モバイル対応 | 備考 |
|--------|-------------|------|
| Header表示 | ○ | 共通 |
| WebSocket状態 | ○ | 共通 |
| CPU/MEM表示 | ○ | 簡略化検討 |
| SuggestPane | ○ | アニメーション変更 |
| CameraGrid | ○ | 3列化 |
| カメラスキャン | ○ | 末尾カード |
| カメラタイル | ○ | 正方形固定 |
| DnD並べ替え | ○ | タッチ対応 |
| AIイベントログ | ○ | ドロワー化 |
| 過剰検出サジェスト | ○ | ドロワー内 |
| AIチャット | ○ | ドロワー内 |
| LiveViewModal | ○ | 中央モーダル |
| CameraDetailModal | ○ | 中央モーダル |
| DetectionDetailModal | ○ | 中央モーダル |
| ScanModal | ○ | 中央モーダル |
| SettingsModal | ○ | 中央モーダル |

### 7.2 モバイル専用機能

| 機能 | 説明 |
|------|------|
| フローティングAIボタン | PC版には不要（常時表示のため） |
| ドロワーメニュー | PC版には不要（ペーン表示のため） |
| スワイプ操作 | 将来対応（Phase 2） |

---

## 8. 非対応事項

以下は本設計の対象外:
- ランドスケープ（横向き）対応
- タブレット最適化（将来対応）
- オフライン対応
- PWA対応
- プッシュ通知

---

## 9. 整合性確認

- [x] SSoT: 新規データソース作成なし
- [x] SOLID: 既存コンポーネント拡張、新規は最小限
- [x] MECE: 全機能網羅確認
- [x] アンアンビギュアス: ブレークポイント768px明確
- [x] 依存関係: useMediaQuery → App → 各コンポーネント
- [x] 車輪の再発明なし: 既存ロジック活用

---

## 10. 次ステップ

1. 詳細設計ドキュメント作成（各コンポーネント）
2. TASK_INDEX作成
3. テスト計画作成
4. GitHub Issue登録
5. 実装前コミット
6. Phase別実装

---

**MECE確認**: 本設計はPC版の全機能をモバイルで網羅し、モバイル専用UIを追加。漏れなし。

**アンアンビギュアス確認**: ブレークポイント、アニメーション方向、列数、サイズ計算式すべて明確に定義。曖昧な点なし。
