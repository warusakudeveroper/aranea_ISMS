# IS22 UI詳細設計書

文書番号: IS22_UI_DETAILED_SPEC
作成日: 2025-12-31
ステータス: 設計中

---

## 0. 本書の目的

追加要件を含むUI実装の全要件を網羅的に定義し、実装・テストの基準とする。

---

## 1. レイアウト要件

### 1.1 3ペイン構成

| ペイン | 幅 | 内容 |
|--------|-----|------|
| 左ペイン（サジェスト） | **30%**（やや大きい） | サジェストライブ動画 |
| 中央ペイン（カメラグリッド） | **45%** | カメラサムネ羅列（基本3列） |
| 右ペイン（ログ） | **25%** | AI解析ログ |

### 1.2 ヘッダー

| 要素 | 内容 | 位置 |
|------|------|------|
| ロゴ | ビデオアイコン | 左 |
| タイトル | mobes AIcam control Tower | 左 |
| バッジ | mAcT | タイトル横 |
| システムステータス | CPU/MEM/Modals/Healthy | 右 |
| スキャンボタン | 「🔍 スキャン」 | 右 |
| 設定ボタン | 歯車アイコン | 右端 |

---

## 2. カメラグリッド要件

### 2.1 基本表示

- **デフォルト3列**表示
- カメラ数に応じてスケール（4列、5列...）

### 2.2 カメラ0件時: ブランクカード

**必須要件**: カメラが0件の場合、以下のブランクカードを表示

```
┌─────────────────────────────────┐
│         [カメラアイコン]          │
│                                 │
│    カメラが登録されていません      │
│                                 │
│   ┌─────────────────────────┐   │
│   │  ＋ カメラを追加         │   │  ← クリックでスキャンモーダル
│   └─────────────────────────┘   │
│                                 │
│   ONVIF / RTSP対応カメラを自動検出 │
└─────────────────────────────────┘
```

### 2.3 カメラカード

| 要素 | 内容 |
|------|------|
| サムネイル | カメラ画像（取得失敗時はプレースホルダー） |
| カメラ名 | 例: Tapo C113 - ISMS Room |
| ロケーション | 例: Ichiyama Facility |
| ステータスバッジ | オンライン/オフライン/エラー |

### 2.4 カメラカードクリック動作

- クリック → カメラ詳細モーダル表示（将来実装）
- 現段階では selectedCameraId を更新

---

## 3. スキャンモーダル要件

### 3.1 モーダル構成

```
┌──────────────────────────────────────────────────┐
│  🔍 カメラスキャン - {subnetCidr}            [×] │
├──────────────────────────────────────────────────┤
│                                                  │
│  [サブネット設定セクション]                        │
│  ┌────────────────────────────────────────────┐  │
│  │ サブネット: [192.168.125.0/24 ▼]           │  │
│  │ ┌──────────────────────────────────────┐  │  │
│  │ │ + サブネットを追加                    │  │  │
│  │ └──────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────┘  │
│                                                  │
│  [クレデンシャル設定セクション]                    │
│  ┌────────────────────────────────────────────┐  │
│  │ このサブネットのクレデンシャル:              │  │
│  │ ┌──────────────────────────────────────┐  │  │
│  │ │ 1. halecam / hale0083        [編集]  │  │  │
│  │ │ 2. ismscam / isms12345@      [編集]  │  │  │
│  │ └──────────────────────────────────────┘  │  │
│  │ ┌──────────────────────────────────────┐  │  │
│  │ │ + クレデンシャルを追加               │  │  │
│  │ └──────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────┘  │
│                                                  │
│  ┌────────────────────────────────────────────┐  │
│  │           🔍 スキャン開始                  │  │
│  └────────────────────────────────────────────┘  │
│                                                  │
└──────────────────────────────────────────────────┘
```

### 3.2 スキャン中表示（必須: 可視化）

**レーダースピナー**: 同心円 + 回転スイープ + 点滅ブリップ

```
┌──────────────────────────────────────────────────┐
│  🔍 カメラスキャン - 192.168.125.0/24        [×] │
├──────────────────────────────────────────────────┤
│                                                  │
│              ╭─────────────╮                     │
│             ╱   ◉     ◉   ╲                    │
│            │    ╭───╮      │    [レーダー]       │
│            │    │ ● │      │                    │
│            │    ╰───╯      │                    │
│             ╲   ◉         ╱                     │
│              ╰─────────────╯                     │
│                                                  │
│         ネットワークをスキャン中...               │
│                                                  │
│  [Phase表示 - 必須]                              │
│  ┌────────────────────────────────────────────┐  │
│  │ [ARP Scan] → [Port Scan] → [OUI] → ...    │  │
│  │     ✓          ●(実行中)     ○              │  │
│  └────────────────────────────────────────────┘  │
│                                                  │
│  [進捗バー]                                       │
│  ████████████░░░░░░░░░░░░░░░░░░░  35%           │
│                                                  │
│  [スキャン詳細ログ - 必須: 何をスキャンして何を判定] │
│  ┌────────────────────────────────────────────┐  │
│  │ 12:34:56 192.168.125.1  - ARP応答あり      │  │
│  │ 12:34:56 192.168.125.78 - ARP応答あり      │  │
│  │ 12:34:57 192.168.125.78 - Port 554 open    │  │
│  │ 12:34:57 192.168.125.78 - Port 2020 open   │  │
│  │ 12:34:58 192.168.125.78 - OUI: TP-Link     │  │
│  │ 12:34:58 → カメラ候補として判定             │  │
│  └────────────────────────────────────────────┘  │
│                                                  │
│  検出デバイス: 5台                               │
│                                                  │
└──────────────────────────────────────────────────┘
```

### 3.3 スキャン完了: 登録候補表示

```
┌──────────────────────────────────────────────────┐
│  🔍 カメラスキャン - 192.168.125.0/24        [×] │
├──────────────────────────────────────────────────┤
│                                                  │
│  検出デバイス (8台)                [カメラを全選択] │
│                                                  │
│  ┌────────────────────────────────────────────┐  │
│  │ [✓] 192.168.125.78                         │  │
│  │     TP-Link (Tapo)                         │  │
│  │     [カメラ確認済] Port: 554, 2020        │  │
│  │     「ONVIF応答あり、RTSPストリーム確認済」   │  │
│  └────────────────────────────────────────────┘  │
│                                                  │
│  ┌────────────────────────────────────────────┐  │
│  │ [✓] 192.168.125.85                         │  │
│  │     TP-Link (Tapo)                         │  │
│  │     [カメラ確認済] Port: 554, 2020        │  │
│  │     「登録済み」 ← 既存カメラの場合          │  │
│  └────────────────────────────────────────────┘  │
│                                                  │
│  ┌────────────────────────────────────────────┐  │
│  │ [ ] 192.168.125.100                        │  │
│  │     Unknown                                │  │
│  │     [ネットワーク機器] Port: 80, 443       │  │
│  │     「カメラではない可能性」                 │  │
│  └────────────────────────────────────────────┘  │
│                                                  │
│  ┌────────────────────────────────────────────┐  │
│  │ [ ] 192.168.125.200                        │  │
│  │     VIGI                                   │  │
│  │     [クレデンシャル必要]                    │  │
│  │     「認証失敗 - クレデンシャル編集で再試行」 │  │
│  │                           [クレデンシャル編集] │
│  └────────────────────────────────────────────┘  │
│                                                  │
├──────────────────────────────────────────────────┤
│  3台選択中                                       │
│  ┌────────────────────────────────────────────┐  │
│  │         選択したデバイスを登録 (3)          │  │
│  └────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────┘
```

### 3.4 モーダル閉じる時の確認ダイアログ（alert不使用）

**条件**: 処理中 または 未登録の登録可能デバイスがある場合

```
┌──────────────────────────────────────────────────┐
│  ⚠️ CameraScanを終了しますか？                   │
├──────────────────────────────────────────────────┤
│                                                  │
│  登録済み: 2件                                   │
│  新規検出: 5台                                   │
│  未登録の登録可能デバイス: 3台                    │
│                                                  │
│  登録されていない登録可能デバイスがあります。      │
│  CameraScanを終了してもよろしいですか？           │
│                                                  │
├──────────────────────────────────────────────────┤
│              [キャンセル]  [終了する]             │
└──────────────────────────────────────────────────┘
```

---

## 4. ログペイン要件

### 4.1 カラーリング（視認性確保）

| Severity | ライトテーマ | ダークテーマ | 左ボーダー |
|----------|-------------|-------------|-----------|
| 0 (Info) | bg-zinc-100 | bg-zinc-800/60 | なし |
| 1 (Low) | bg-blue-50 | bg-blue-900/40 | blue-500 2px |
| 2 (Medium) | bg-amber-50 | bg-amber-900/40 | amber-500 2px |
| 3 (High) | bg-red-50 | bg-red-900/50 | red-500 2px |

### 4.2 ログ項目

- タイムスタンプ
- カメラ名
- イベント内容（人検出、動体検知等）
- サムネイル（オプション）

---

## 5. サジェストペイン要件

### 5.1 イベントなし時

```
┌─────────────────────────┐
│                         │
│     [ビデオアイコン]      │
│                         │
│    No active events     │
│  Events will appear     │
│  here when detected     │
│                         │
└─────────────────────────┘
```

### 5.2 イベントあり時

- サジェスト対象カメラのライブ表示
- イベント情報オーバーレイ

---

## 6. CRUD要件

### 6.1 Create（カメラ登録）

| 操作 | エンドポイント | UI |
|------|--------------|-----|
| 単体登録 | POST /api/cameras | 将来実装 |
| 一括登録 | POST /api/cameras/batch | スキャンモーダルの「登録」ボタン |

### 6.2 Read（カメラ取得）

| 操作 | エンドポイント | UI |
|------|--------------|-----|
| 一覧取得 | GET /api/cameras | カメラグリッド表示 |
| 詳細取得 | GET /api/cameras/{id} | カメラ詳細モーダル（将来） |

### 6.3 Update（カメラ更新）

| 操作 | エンドポイント | UI |
|------|--------------|-----|
| 設定更新 | PUT /api/cameras/{id} | カメラ設定モーダル（将来） |

### 6.4 Delete（カメラ削除）

| 操作 | エンドポイント | UI |
|------|--------------|-----|
| 単体削除 | DELETE /api/cameras/{id} | カメラ設定モーダル（将来） |

---

## 7. 全ボタン一覧

| ID | ボタン | 場所 | 動作 |
|----|--------|------|------|
| BTN-001 | スキャンボタン | ヘッダー | スキャンモーダル表示 |
| BTN-002 | 設定ボタン | ヘッダー | 設定モーダル表示（将来） |
| BTN-003 | +カメラを追加 | ブランクカード | スキャンモーダル表示 |
| BTN-004 | スキャン開始 | スキャンモーダル | スキャン実行 |
| BTN-005 | カメラを全選択 | スキャンモーダル | カメラ候補を全選択 |
| BTN-006 | 選択解除 | スキャンモーダル | 選択をすべて解除 |
| BTN-007 | 選択したデバイスを登録 | スキャンモーダル | 一括登録実行 |
| BTN-008 | クレデンシャル編集 | デバイスカード | クレデンシャル編集モーダル |
| BTN-009 | +サブネットを追加 | スキャンモーダル | サブネット追加フォーム |
| BTN-010 | +クレデンシャルを追加 | スキャンモーダル | クレデンシャル追加フォーム |
| BTN-011 | モーダル閉じる(×) | 各モーダル | モーダルを閉じる |
| BTN-012 | 確認ダイアログ「終了する」 | 確認ダイアログ | 処理を中断して閉じる |
| BTN-013 | 確認ダイアログ「キャンセル」 | 確認ダイアログ | ダイアログを閉じて継続 |
| BTN-014 | カメラカード | カメラグリッド | カメラ選択 |

---

## 8. 全入力一覧

| ID | 入力 | 場所 | 種類 |
|----|------|------|------|
| INPUT-001 | サブネット選択 | スキャンモーダル | セレクト |
| INPUT-002 | サブネットCIDR | サブネット追加フォーム | テキスト |
| INPUT-003 | クレデンシャル ユーザー名 | クレデンシャルフォーム | テキスト |
| INPUT-004 | クレデンシャル パスワード | クレデンシャルフォーム | パスワード |
| INPUT-005 | デバイス選択チェックボックス | デバイスカード | チェックボックス |

---

## 9. テスト項目

### 9.1 全ボタンテスト

| テストID | 対象 | 操作 | 期待結果 |
|----------|------|------|---------|
| BTN-TEST-001 | スキャンボタン | クリック | スキャンモーダル表示 |
| BTN-TEST-002 | 設定ボタン | クリック | 設定モーダル表示 |
| BTN-TEST-003 | +カメラを追加 | クリック | スキャンモーダル表示 |
| BTN-TEST-004 | スキャン開始 | クリック | スキャン実行・Phase表示 |
| BTN-TEST-005 | カメラを全選択 | クリック | 全カメラ候補選択 |
| BTN-TEST-006 | 選択解除 | クリック | 全選択解除 |
| BTN-TEST-007 | 登録ボタン | クリック | 確認ダイアログ→登録実行 |
| BTN-TEST-008 | モーダル閉じる | クリック | 確認ダイアログ（条件付き） |
| BTN-TEST-009 | 確認ダイアログ終了 | クリック | モーダル閉じる |
| BTN-TEST-010 | 確認ダイアログキャンセル | クリック | ダイアログ閉じる |
| BTN-TEST-011 | カメラカード | クリック | カメラ選択状態変更 |

### 9.2 全入力テスト

| テストID | 対象 | 操作 | 期待結果 |
|----------|------|------|---------|
| INPUT-TEST-001 | サブネット選択 | 変更 | 選択サブネット変更 |
| INPUT-TEST-002 | サブネットCIDR | 入力 | バリデーション |
| INPUT-TEST-003 | ユーザー名 | 入力 | 値保持 |
| INPUT-TEST-004 | パスワード | 入力 | マスク表示・値保持 |
| INPUT-TEST-005 | デバイスチェック | クリック | 選択状態トグル |

### 9.3 CRUDテスト

| テストID | 操作 | 手順 | 期待結果 |
|----------|------|------|---------|
| CRUD-C-001 | Create | スキャン→選択→登録 | カメラ登録成功 |
| CRUD-R-001 | Read | ページ表示 | カメラ一覧表示 |
| CRUD-R-002 | Read | スキャン完了 | 検出デバイス表示 |
| CRUD-U-001 | Update | （将来実装） | - |
| CRUD-D-001 | Delete | （将来実装） | - |

---

## 10. 実装優先度

| 優先度 | 項目 |
|--------|------|
| P0 | レイアウト修正（サジェスト30%、グリッド45%、ログ25%） |
| P0 | ブランクカード「+カメラを追加」 |
| P0 | スキャンモーダル Phase表示・詳細ログ |
| P0 | 確認ダイアログ（閉じる時） |
| P0 | ログカラーリング（ダークテーマ確認） |
| P1 | サブネット設定UI |
| P1 | クレデンシャル設定UI |
| P2 | カメラ詳細モーダル |
| P2 | 設定モーダル |

---

## 更新履歴

| 日付 | バージョン | 内容 |
|-----|-----------|------|
| 2025-12-31 | 1.0 | 初版作成 |
