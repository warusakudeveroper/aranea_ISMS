# IS22 → Mobes サマリー出力改善依頼

**作成日**: 2026-01-14
**発行元**: IS22開発チーム
**宛先**: Mobes LLM/Paraclate開発チーム

---

## 1. 概要

IS22のParaclate連携においてサマリー生成のLLM出力に問題があり、以下の修正を依頼します。

## 2. 問題点

### 2.1 冗長な挨拶・結びの定型文

**現状の出力例:**
```
こんにちは、施設管理者様。
施設監視・分析AIアシスタント「Paraclate」です。
IS22システムから受信したデータに基づき、直近1時間の定時サマリーを生成しました。

[サマリー本文]

引き続き、施設の状況を注意深く見守ります。
---
何かご不明な点や、さらに詳しく分析したい項目がございましたら、
いつでもお声がけください。
```

**問題**:
- IS22側で既にヘッダー（期間、検出件数、重要度）を付与しているため、LLMの挨拶・結びは完全に冗長
- チャットUIの縦幅を無駄に消費
- ユーザー体験低下

**期待する出力**:
```
【直近1時間 定時サマリー】

* 全体状況:
  施設全体は安定して稼働中。特に注意が必要な事象なし。

* カメラ状況:
  - オフライン: 2台（Toj 1FEVT, Tam-Smoking）
  - オンライン: 15台

* 検出イベント:
  なし
```

### 2.2 ハルシネーション（情報がない時の意味不明回答）

**現状の問題**:
- 検出イベントがゼロ、またはデータが不十分な場合
- LLMが「ゲストの皆様は、穏やかにお過ごしのことと存じます」等の根拠のない推測を生成
- 事実に基づかない情報がユーザーに表示される

**例**:
```
ゲストの皆様は、穏やかにお過ごしのことと存じます。
```
↑ 実際のデータからは確認できない内容

**期待する対応**:
- データがない場合は「検出イベントなし」とのみ回答
- 推測・憶測を含む文言を禁止
- 事実ベースの記述に限定

### 2.3 サマリー出力ログの要件未達

**現在のサマリー内容**:
- 検出件数のみ
- カメラ状況の要約なし
- 時系列分析なし

**期待するサマリー内容**:
1. **カメラ稼働状況**
   - オンライン/オフライン台数
   - オフラインカメラの名前・最終接続時刻

2. **検出イベント概要**
   - 検出件数（人/車両/その他）
   - 重要度分布（severity 1〜4）
   - 検出が多かったカメラTOP3

3. **異常検知**
   - カメラオフライン発生（severity 4）
   - 高頻度検出エリア

4. **システム健全性**
   - 全体的な稼働率
   - 推論レイテンシ平均

## 3. 技術的補足

### 3.1 IS22からのデータ構造

IS22は以下のデータ構造でIngest APIに送信しています：

```json
{
  "summaryOverview": {
    "summaryID": "SUM-950",
    "detectedEvents": "26",
    "firstDetectAt": "2026-01-14T04:49:53.026+00:00",
    "lastDetectAt": "2026-01-14T05:47:38.731+00:00"
  },
  "cameraStatusSummary": {
    "totalCameras": 17,
    "onlineCameras": 15,
    "offlineCameras": 2,
    "offlineCameraDetails": [
      {
        "cameraName": "Toj 1FEVT",
        "ipAddress": "192.168.126.23",
        "lacisId": "38013C846AD91A9F0000",
        "lastOnlineAt": "2026-01-14T04:49:53.026+00:00",
        "reason": "camera_lost"
      }
    ],
    "connectionLostEvents": 15,
    "systemHealth": "degraded"
  },
  "cameraContext": {
    // カメラ名とコンテキストのマップ
  },
  "lacisOath": {
    "tid": "T2025120621041161827",
    "lacisID": "3022E051D815448B0001",
    "cic": "605123"
  }
}
```

### 3.2 LLM出力形式

- IS22フロントエンドはMarkdownをパース可能
- 適切なMarkdown形式での出力を推奨
- 過度な装飾（絵文字等）は不要

## 4. 修正依頼事項

| No | カテゴリ | 依頼内容 | 優先度 |
|----|---------|---------|--------|
| 1 | 定型文削除 | 挨拶・結びの定型文を完全削除 | 高 |
| 2 | ハルシネーション防止 | データがない場合は事実のみ記述 | 高 |
| 3 | サマリー内容充実 | カメラ稼働状況・検出概要・異常検知を含める | 中 |
| 4 | 出力形式 | Markdown形式で簡潔に出力 | 低 |

## 5. 確認方法

修正後、以下のAPIで確認可能：

```bash
# 1時間サマリー強制生成
curl -X POST http://192.168.125.246:3000/api/summary/force-hourly \
  -H "Content-Type: application/json" \
  -d '{}'

# 最新サマリー取得
curl "http://192.168.125.246:3000/api/summary/latest?tid=T2025120621041161827&fid=0150"

# チャットメッセージ確認
curl "http://192.168.125.246:3000/api/chat/messages"
```

## 6. 連絡先

- IS22リポジトリ: `code/orangePi/is22/`
- 共有ドキュメント: `doc/APPS/Paraclate/LLM/`

---

**変更履歴**:
- 2026-01-14: 初版作成
