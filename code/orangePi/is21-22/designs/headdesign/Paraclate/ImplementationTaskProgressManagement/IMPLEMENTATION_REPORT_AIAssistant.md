# AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆUIæ”¹å–„ å®Ÿè£…å ±å‘Šæ›¸

## æ¦‚è¦

| é …ç›® | å†…å®¹ |
|------|------|
| å®Ÿè£…æ—¥ | 2026-01-12 |
| ã‚³ãƒŸãƒƒãƒˆ | 560c310 |
| å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ  | IS22 CamServer |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | E2Eãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº† |

## å®Ÿè£…å†…å®¹

### 1. ChatExpandModalï¼ˆæ‹¡å¤§ãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/components/ChatExpandModal.tsx`

AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãƒãƒ£ãƒƒãƒˆã‚’å¤§ããªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã€‚

#### æ©Ÿèƒ½
- é’è‰²ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆAIã‚¢ã‚¤ã‚³ãƒ³ + ã‚¿ã‚¤ãƒˆãƒ«ï¼‰
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã®å…¨ç”»é¢è¡¨ç¤º
- å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆEnteré€ä¿¡å¯¾å¿œï¼‰
- ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆã¯ã„/ã„ã„ãˆï¼‰å¯¾å¿œ

#### UIä»•æ§˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ          [X]         â”‚  â† é’è‰²ãƒ˜ãƒƒãƒ€ãƒ¼
â”‚     is22 mobes2.0é€£æº                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  [AI] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹...                 â”‚
â”‚                           [ã¯ã„][ã„ã„ãˆ]â”‚
â”‚                                         â”‚
â”‚                    [User] ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›  â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...]            [é€ä¿¡] â”‚
â”‚              ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. è‡ªå‹•å‰Šé™¤æ©Ÿèƒ½ï¼ˆã€Œã„ã„ãˆã€å¿œç­”ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/components/EventLogPane.tsx`

æ¤œå‡ºå‚¾å‘èª¿æ•´ã‚µã‚¸ã‚§ã‚¹ãƒˆã§ã€Œã„ã„ãˆã€ã‚’é¸æŠã—ãŸéš›ã®å¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ1åˆ†å¾Œã«è‡ªå‹•å‰Šé™¤ã•ã‚Œã‚‹æ©Ÿèƒ½ã€‚

#### å®Ÿè£…è©³ç´°
- `dismissAt`: å‰Šé™¤äºˆå®šã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆç¾åœ¨æ™‚åˆ» + 60ç§’ï¼‰
- `isHiding`: ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ãƒ•ãƒ©ã‚°
- 5ç§’é–“éš”ã§ã‚¿ã‚¤ãƒãƒ¼ãƒã‚§ãƒƒã‚¯
- å‰Šé™¤å‰ã«å·¦ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ300msï¼‰

```typescript
// ã€Œã„ã„ãˆã€ã‚¯ãƒªãƒƒã‚¯æ™‚
setChatMessages((prev) => [
  ...prev,
  {
    id: `dismiss-${Date.now()}`,
    role: "assistant",
    content: "äº†è§£ã—ã¾ã—ãŸã€‚ç¾åœ¨ã®è¨­å®šã‚’ç¶­æŒã—ã¾ã™ã€‚",
    timestamp: new Date(),
    dismissAt: Date.now() + 60000,  // 1åˆ†å¾Œã«è‡ªå‹•å‰Šé™¤
  },
])
```

### 3. API URLä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/lib/config.ts`

æœ¬ç•ªç’°å¢ƒã§ã®API URLã‚’ä¿®æ­£ã€‚

#### å¤‰æ›´å‰
```typescript
export const API_BASE_URL = import.meta.env.DEV
  ? ""
  : "http://192.168.125.246:8080"  // â† é–“é•ã„
```

#### å¤‰æ›´å¾Œ
```typescript
export const API_BASE_URL = ""  // åŒä¸€ã‚ªãƒªã‚¸ãƒ³ï¼ˆãƒãƒ¼ãƒˆ3000ï¼‰
export const WS_BASE_URL = `ws://${window.location.host}`
```

### 4. é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/main.rs`, `Cargo.toml`

Rust Axumãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ä¿¡ã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã€‚

```rust
// Cargo.toml
tower-http = { version = "0.5", features = ["cors", "trace", "compression-gzip", "fs"] }

// main.rs
let static_dir = std::env::var("STATIC_DIR")
    .unwrap_or_else(|_| "/opt/is22/frontend/dist".to_string());
let serve_dir = ServeDir::new(&static_dir)
    .not_found_service(ServeFile::new(format!("{}/index.html", static_dir)));

let app = web_api::create_router(state.clone())
    .fallback_service(serve_dir)
    // ...
```

### 5. entranceãƒ—ãƒªã‚»ãƒƒãƒˆä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/preset_loader/mod.rs`

entranceï¼ˆã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹ï¼‰ãƒ—ãƒªã‚»ãƒƒãƒˆã®confidenceé–¾å€¤ã‚’èª¿æ•´ã€‚

#### å•é¡Œ
- `conf_override: 0.35` ãŒä½ã™ãã¦unknownæ¤œå‡ºãŒå¤šç™º
- 24æ™‚é–“ã§145ä»¶ã®unknownï¼ˆ52%ï¼‰â†’ éæ¤œå‡ºã‚µã‚¸ã‚§ã‚¹ãƒˆãŒé€£ç¶šè¡¨ç¤º

#### ä¿®æ­£
```rust
// Before
conf_override: Some(0.35),

// After
conf_override: Some(0.45),  // v2.0.1: unknown floodå¯¾ç­–
```

## ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³

| ç’°å¢ƒ | URL | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|------|-----|----------|
| IS22 CamServer | http://192.168.125.246:3000 | âœ… ç¨¼åƒä¸­ |
| IS21 æ¨è«–ã‚µãƒ¼ãƒãƒ¼ | http://192.168.3.240:9000 | âœ… æ¥ç¶šæ¸ˆã¿ |
| Paraclate API | asia-northeast1 | âœ… æ¥ç¶šæ¸ˆã¿ |

## æ¤œè¨¼çµæœ

### æ©Ÿèƒ½æ¤œè¨¼

| æ©Ÿèƒ½ | çµæœ | å‚™è€ƒ |
|------|------|------|
| æ‹¡å¤§ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º | âœ… Pass | ã€Œæ‹¡å¤§è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã§é–‹ã |
| ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹ | âœ… Pass | - |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ | âœ… Pass | Enter/é€ä¿¡ãƒœã‚¿ãƒ³ |
| è‡ªå‹•å‰Šé™¤ï¼ˆ1åˆ†å¾Œï¼‰ | âœ… Pass | ã‚¿ã‚¤ãƒãƒ¼å‹•ä½œç¢ºèª |
| ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆ | âœ… Pass | å·¦æ–¹å‘ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ |

### DB/APIæ¥ç¶šæ¤œè¨¼

| é …ç›® | çµæœ | å€¤ |
|------|------|-----|
| System Health | âœ… | healthy |
| Cameras | âœ… | 17å° |
| Detection Logs | âœ… | 147,368ä»¶ |
| Subnets | âœ… | 4ä»¶ |
| Paraclate | âœ… | connected |
| IS21 Latency | âœ… | 95ms |

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. E2E UIãƒ†ã‚¹ãƒˆå®Ÿæ–½
2. mobes2.0é€£æºãƒ†ã‚¹ãƒˆ
3. AIã‚µãƒãƒªãƒ¼ç”Ÿæˆæ¤œè¨¼
4. ParaclateåŒæ–¹å‘åŒæœŸç¢ºèª
