# AIEventLog設計ドキュメント レビューフィードバック

文書番号: Layout＆AIlog_Settings/AIEventLog_Design_Review_Feedback
作成日: 2026-01-08
レビュー対象:
- AIEventLog_Redesign_v1.md
- AIEventLog_Redesign_v2.md
参照文書:
- AIEventlog.md（要件定義）
- The_golden_rules.md（絶対遵守原則）

---

## 重要声明

> The_golden_rules.md Rule 16: 「ルール無視はルールを無視した時点からやり直すこと」

**設計ドキュメント段階でThe_golden_rules.md違反が存在する場合、実装を開始することはできない。**
違反を解消した設計ドキュメントが承認されるまで、タスクは設計フェーズに留まる。

---

## 1. v1レビュー結果: 却下

### 1.1 The_golden_rules.md違反一覧

| 違反ID | ルール | 違反箇所 | 内容 |
|--------|--------|----------|------|
| V1-001 | **Rule 7** | Section 10 | 「将来拡張（Phase 2）」という表現が棚上げを誘発 |
| V1-002 | Rule 7 | Section 2.3 | 「Phase 2（将来）」という分類自体が依存関係・実装順以外の優先順位付け |
| V1-003 | Rule 3 | 全体 | MECEが不完全。ストレージ問題が表示問題と分離されていない |
| V1-004 | Rule 9 | Section 7 | バックエンドテストが定義されていない |
| V1-005 | Rule 15 | 全体 | AIEventlog.mdの「AI判定について」セクションの要件が未対応 |

### 1.2 AIEventlog.md要件未対応一覧

| 要件ID | AIEventlog.md記載 | v1対応 |
|--------|-------------------|--------|
| REQ-01 | ラベル翻訳（human→人物検知） | 未対応 |
| REQ-02 | ストレージクォータ設定 | 「Phase 2」として棚上げ |
| REQ-03 | unknown画像クリーンアップ | 「Phase 2」として棚上げ |
| REQ-04 | 推論統計タブ | 「Phase 2」として棚上げ |
| REQ-05 | IS21/IS22評価方法解説 | 未対応 |
| REQ-06 | プリセット効果分析 | 「Phase 2」として棚上げ |
| REQ-07 | autoAttunement基本設計 | 「Phase 2」として棚上げ |

### 1.3 v1却下理由

**Rule 7違反が致命的**:
> 「優先順位は依存関係と実装順によってのみ定義される。棚上げにして将来実装などというケースはありません。」

v1の「将来拡張（Phase 2）」は明確なRule 7違反であり、この設計に基づく実装は開始できない。

---

## 2. v2レビュー結果: 条件付き保留

### 2.1 The_golden_rules.md違反一覧

| 違反ID | ルール | 違反箇所 | 内容 | 重大度 |
|--------|--------|----------|------|--------|
| V2-001 | **Rule 7** | 全体 | autoAttunement基本設計が**完全省略**されている。これは「触れないことによる暗黙の棚上げ」 | Critical |
| V2-002 | **Rule 7** | 全体 | IS21/IS22評価方法解説が**完全省略**。AIEventlog.mdで明示的に要求されている | Critical |
| V2-003 | Rule 4 | Section 4.1.1 | 画像保存条件の真理値表がなく、テストケースとの整合性が曖昧 | High |
| V2-004 | Rule 4 | Section 4.2.5 | getIconColor関数がコメントのみで実装コードがない | High |
| V2-005 | Rule 4 | Section 4.1.3 | CleanupStats構造体の定義がない | Medium |
| V2-006 | Rule 15 | 全体 | GitHub Issue登録手順がない | Medium |
| V2-007 | Rule 15 | 全体 | 実装前コミット手順がない | Medium |

### 2.2 Rule 7違反の詳細分析

#### V2-001: autoAttunement基本設計の省略

**AIEventlog.md原文（line 47）**:
> 「autoAttunementの調整用API(LLMおよび人力調整)の機能拡張が必要でありその基本設計ドキュメントの作成と実装予定todoをコード内に組み込んでおく必要性を意味する」

**v2の対応**: 完全省略

**Rule 7との関係**:
- v1は「将来拡張」と明示して棚上げした → 違反が明確
- v2は**言及自体をしない**ことで棚上げした → これも違反

**Rule 7の解釈**: 「棚上げにして将来実装などというケースはありません」は、要件を無視することも含む。要件が存在する以上、何らかの形で設計に含めなければならない。

#### V2-002: IS21/IS22評価方法解説の省略

**AIEventlog.md原文（line 17）**:
> 「まずis21とis22の評価方法、評価基準、レスポンスの内容などについて詳細に解説してください。必ずエビデンスをつけてプリセットが明確に働いているか、直近画像を二枚送って差分査定をおこなっているかを解説してください」

**v2の対応**: 完全省略

**影響**: この解説なしでは後続タスクの設計基盤が不明確。

---

### 2.3 Rule 4違反の詳細

#### V2-003: 画像保存条件のアンビギュアス

**v2記載**:
```rust
let should_save_image = result.severity > 0
    || result.primary_event != "none"
    || result.unknown_flag;
```

**テストケースBE-02**:
> 「severity=0でsave_detection呼び出し → 画像保存されない」

**矛盾**:
- `severity=0` かつ `unknown_flag=true` → 画像は**保存される**
- テストケースの期待結果と条件が一致しない

**必要な真理値表**:

| severity | primary_event | unknown_flag | 画像保存 |
|----------|---------------|--------------|----------|
| 0 | none | false | **保存しない** |
| 0 | none | true | 保存する |
| 0 | human | false | 保存する |
| 0 | unknown | true | 保存する |
| 1+ | any | any | 保存する |

#### V2-004: getIconColor関数の不完全

**v2記載**:
```typescript
function getIconColor(primaryEvent: string): string {
  // getEventStyleと同じロジックでcolorKeyを決定
  // ICON_COLORS[colorKey]を返す
}
```

**問題**: 実装ではなくコメント。Rule 4「アンアンビギュアス」はこのような曖昧な記述を許容しない。

---

### 2.4 v2のThe_golden_rules.md準拠まとめ

| ルール | 準拠状況 | ブロッカー |
|--------|----------|------------|
| Rule 1 (SSoT) | ✓ 準拠 | - |
| Rule 2 (SOLID) | ✓ 準拠 | - |
| Rule 3 (MECE) | ✓ 準拠 | - |
| Rule 4 (Unambiguous) | **✗ 違反** | V2-003, V2-004, V2-005 |
| Rule 6 (現場猫禁止) | ✓ 準拠 | - |
| Rule 7 (棚上げ禁止) | **✗ 違反** | V2-001, V2-002 |
| Rule 9 (テスト必須) | △ 条件付き | テストケース修正必要 |
| Rule 12 (車輪禁止) | ✓ 準拠 | - |
| Rule 15 (設計必須) | **✗ 違反** | V2-006, V2-007 |

**結論**: Rule 4, Rule 7, Rule 15に違反があり、**実装を開始できない**。

---

## 3. v2承認に必要な修正事項

### 3.1 Critical（実装開始のブロッカー）

| 修正ID | 違反ID | 修正内容 |
|--------|--------|----------|
| FIX-C01 | V2-001 | autoAttunement基本設計セクション追加。全機能実装は不要だが、基本設計骨子とTODO箇所を明示 |
| FIX-C02 | V2-002 | IS21/IS22評価方法解説セクション追加。評価フロー、プリセット動作確認方法、差分査定の仕組みを解説 |

### 3.2 High（テスト実行のブロッカー）

| 修正ID | 違反ID | 修正内容 |
|--------|--------|----------|
| FIX-H01 | V2-003 | 画像保存条件の真理値表追加、テストケースBE-02〜BE-05を修正 |
| FIX-H02 | V2-004 | getIconColor関数の完全実装コード提供 |

### 3.3 Medium（品質向上）

| 修正ID | 違反ID | 修正内容 |
|--------|--------|----------|
| FIX-M01 | V2-005 | CleanupStats構造体定義追加 |
| FIX-M02 | V2-006 | GitHub Issue登録手順追加（Issue番号予約） |
| FIX-M03 | V2-007 | 実装前コミット手順追加 |

---

## 4. 修正優先順位と依存関係

```
FIX-C01 (autoAttunement) ─┬─> FIX-H01 (真理値表) ─> FIX-M02 (Issue登録)
                         │
FIX-C02 (IS21/IS22解説)  ─┘

FIX-H02 (getIconColor)   ─> FIX-M01 (CleanupStats)

FIX-M03 (コミット手順)   (独立)
```

**最短パス**: FIX-C01 → FIX-C02 → FIX-H01 → FIX-H02 → FIX-M01〜M03

---

## 5. レビューサイクル

### 現在の状態

```
AIEventlog.md(要件) → v1(設計) → レビュー → 却下(Rule 7違反)
                   → v2(設計) → レビュー → 保留(修正必要)
                                        ↓
                                   [現在地点]
                                   修正待ち
```

### 次のアクション

1. **v3作成**: FIX-C01, FIX-C02, FIX-H01, FIX-H02, FIX-M01〜M03を反映
2. **レビュー**: v3がThe_golden_rules.md準拠か再確認
3. **承認**: 違反なしで承認
4. **Issue登録**: GitHub Issue作成
5. **実装前コミット**: 設計ドキュメントをコミット
6. **実装開始**: タスクリストに従って実装

---

## 6. The_golden_rules.md遵守の再確認

本レビューは以下の大原則に基づいて実施:

- [x] **Rule 7準拠**: 「棚上げ」「将来実装」の表現・暗黙の省略を全て指摘
- [x] **Rule 4準拠**: アンビギュアスな記述を全て指摘
- [x] **Rule 9準拠**: テストケースの不整合を指摘
- [x] **Rule 15準拠**: 設計手順の欠落を指摘
- [x] **Rule 16準拠**: 違反が解消されるまで実装開始を禁止

---

## 7. 結論

| 設計文書 | 判定 | 理由 |
|----------|------|------|
| v1 | **却下** | Rule 7違反（「将来拡張」表現） |
| v2 | **保留** | Rule 4, 7, 15違反（暗黙の棚上げ、アンビギュアス、手順欠落） |

**次のステップ**: v3を作成し、全違反事項を解消した上で再レビューを受ける。

---

## 付録: レビュー根拠となるThe_golden_rules.md条文

### Rule 4
> 「アンアンビギュアスな報告回答を義務化しアンアンビギュアスに到達できていない場合はアンアンビギュアスであると宣言できるまで明確な検証を行う」

### Rule 7
> 「優先順位は依存関係と実装順によってのみ定義される。棚上げにして将来実装などというケースはありません。」

### Rule 15
> 「設計ドキュメントのない実装、タスクリスト、テストリストの無い受け入れ条件が曖昧な実装は禁止です。」

### Rule 16
> 「ルール無視はルールを無視した時点からやり直すこと。」

---

**文書終端**
