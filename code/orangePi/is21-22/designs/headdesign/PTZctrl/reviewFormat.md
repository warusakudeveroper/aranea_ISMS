以下に、指定の内容を織り込んだ **IS22 総合レビュー依頼（Markdown）** の作成案を用意しました。
そのまま `IS22_Comprehensive_Review_20260120.md` に貼り付けて使える体裁です。

````md
# IS22 Comprehensive Review（総合レビュー依頼）- 2026-01-20

## 0. 作成情報
- 作成ドキュメント: IS22_Comprehensive_Review_20260120.md
- 作成コミット: 4694d01

---

## 1. レビューの目的 / ゴール
IS22 の実装（バックエンド / フロントエンド / DBマイグレーション / テスト）を横断して確認し、以下を満たしているか総合的にレビューしていただきたいです。

- **モジュール分割・依存関係が妥当**で、拡張・保守がしやすい
- **カメラ登録〜PTZ制御〜アクセス制御（AccessAbsorber）〜Paraclate連携**が整合し、障害時も破綻しない
- **エラーハンドリング / タイムアウト / リトライ**等が現実運用に耐える
- **テストスイート**が主要パスを押さえ、CI/CD 統合を想定できる

---

## 2. レビュー対象サマリ（全体像）
| セクション | 内容 |
|---|---|
| リポジトリ情報 | ブランチ: main / 最新コミット: 9fc738c |
| バックエンド | 20+ モジュールの GitHub リンク（src 配下） |
| フロントエンド | 15+ コンポーネントの GitHub リンク（frontend/src 配下） |
| マイグレーション | 32 マイグレーションの一覧（migrations 配下） |
| テストスイート | 3 ファイル / 32 テストケース（tests 配下） |
| アーキテクチャ | カメラ登録 / PTZ / AccessAbsorber / Paraclate |
| レビュー項目 | 6 カテゴリ / 25+ チェック項目 |

---

## 3. リポジトリ情報
- ブランチ: `main`
- 最新コミット: `9fc738c`

---

## 4. GitHubリンク一覧（抜粋）
> ※レビュー時は以下ディレクトリ配下のコード全体を横断的に確認してください（必要に応じて個別ファイルへドリルダウン）。

- バックエンド:
  - https://github.com/warusakudeveroper/aranea_ISMS/tree/main/code/orangePi/is22/src
- フロントエンド:
  - https://github.com/warusakudeveroper/aranea_ISMS/tree/main/code/orangePi/is22/frontend/src
- マイグレーション:
  - https://github.com/warusakudeveroper/aranea_ISMS/tree/main/code/orangePi/is22/migrations
- テスト:
  - https://github.com/warusakudeveroper/aranea_ISMS/tree/main/code/orangePi/is22/tests

---

## 5. 対象アーキテクチャ（概略）
### 5.1 主要コンポーネント
- **カメラ登録**
  - Category B/C 分岐
  - フィールド継承設計
  - PTZ 自動検出の設計と実装
- **PTZ 制御**
  - リース管理（排他・利用権）
  - タイムアウト・解放戦略
  - ベンダー差分吸収
- **AccessAbsorber**
  - 優先度制御（重要度の高い要求を通す/落とす）
  - 同時接続制限（過負荷防止）
- **Paraclate 連携**
  - キュー管理（送信順序・再送・滞留）
  - ペイロード形式（互換性・バージョニング）

### 5.2 相互関係（レビュー用の理解補助）
```mermaid
flowchart LR
  UI[Frontend] -->|API/Request| BE[Backend]
  BE -->|Register/Update| CAM[Camera Registration]
  BE -->|Control| PTZ[PTZ Controller]
  BE -->|Gate/Limit| AA[AccessAbsorber]
  BE -->|Enqueue| Q[Queue]
  Q -->|Send Payload| PC[Paraclate]
  BE --> DB[(DB/Migrations)]
  TEST[Test Suite] --> BE
````

---

## 6. レビュー依頼項目（6カテゴリ）

1. **アーキテクチャ**: モジュール分割、依存関係、エラーハンドリング
2. **カメラ登録**: Category B/C分岐、フィールド継承、PTZ自動検出
3. **PTZ制御**: リース管理、タイムアウト、ベンダー対応
4. **AccessAbsorber**: 優先度制御、同時接続制限
5. **Paraclate連携**: キュー管理、ペイロード形式
6. **テストスイート**: カバレッジ、エッジケース、CI/CD統合

---

## 7. チェックリスト（25+）

> チェック結果は、可能なら「指摘 / 影響 / 再現条件 / 改善案（あれば）/ 該当リンク」を添えてください。

### 7.1 アーキテクチャ（モジュール分割・依存）

* [ ] ドメイン境界（Camera/PTZ/AccessAbsorber/Paraclate）が明確で、責務が混ざっていない
* [ ] 依存方向が一貫している（上位→下位、循環参照や密結合がない）
* [ ] 例外/エラーの扱い方針（握りつぶし、ラップ、再throw）が統一されている
* [ ] ログ粒度が適切（運用で追える情報量、秘匿情報の混入がない）
* [ ] 設定値（タイムアウト/同時接続/キューサイズ等）がコードにベタ書きされていない
* [ ] 将来拡張（新ベンダー/新カテゴリ/新ペイロード）に対して変更点が局所化されている

### 7.2 カメラ登録（Category B/C・継承・PTZ検出）

* [ ] Category B/C 分岐の条件が明確で、仕様と実装がズレていない
* [ ] 分岐ごとに必須フィールド・デフォルト値・バリデーションが破綻していない
* [ ] フィールド継承（共通→派生）の設計が過不足ない（重複 or 欠落がない）
* [ ] PTZ 自動検出が失敗した場合のフォールバックが定義されている
* [ ] PTZ 自動検出の副作用（時間、外部アクセス、例外）が呼び出し元に悪影響を与えない
* [ ] 登録・更新・削除のライフサイクルで状態整合性（DB/キャッシュ/外部）が保たれている

### 7.3 PTZ制御（リース・タイムアウト・ベンダー）

* [ ] リース（排他権）が「誰が・いつまで・何に対して」か一意に追跡できる
* [ ] リース競合時の動作が明確（待つ/拒否/優先度で奪う等）
* [ ] タイムアウトが適切で、失敗時に確実に解放される（リークしない）
* [ ] 通信失敗やベンダー例外時のエラー分類が整理されている（再試行可否が判断できる）
* [ ] ベンダー差分が適切に吸収され、if/else が肥大化していない
* [ ] PTZ操作のキャンセル/中断が必要なケースで安全に停止できる

### 7.4 AccessAbsorber（優先度・同時接続制限）

* [ ] 優先度制御のルールが明確（高優先が常に勝つのか、フェアネスを考慮するのか）
* [ ] 同時接続制限が過負荷回避として機能し、拒否時の応答が適切（原因が追える）
* [ ] 限界値到達時の挙動が安定（スパイク時にスラッシングしない）
* [ ] 重要処理が starvation（飢餓）しない設計になっている
* [ ] 監視可能性（現在接続数、拒否数、待ち行列）が確保されている

### 7.5 Paraclate連携（キュー・ペイロード）

* [ ] キューの責務が明確（順序保証・重複排除・再送戦略・DLQ等の扱い）
* [ ] 送信失敗時の扱い（再試行回数、バックオフ、破棄条件）が仕様化されている
* [ ] キュー滞留時にシステムが崩れない（メモリ/ディスク/DB肥大の抑止策）
* [ ] ペイロード形式が明確（スキーマ/必須項目/型/バージョン）
* [ ] 互換性の戦略がある（将来フィールド追加・廃止に耐える）

### 7.6 テストスイート（カバレッジ・エッジ・CI/CD）

* [ ] テストが 主要ユースケース（登録→PTZ→吸収→送信）を最低限カバーしている
* [ ] エッジケース（タイムアウト、競合、外部失敗、キュー滞留）を意図的に検証している
* [ ] 失敗時に原因がわかる（アサーションが具体的、ログ/メッセージが有用）
* [ ] テストが非決定的になりにくい（時刻依存、並列依存、外部依存の扱い）
* [ ] CI/CD 統合を前提に、再現性（環境依存が少ない）がある
* [ ] カバレッジ向上余地が明確（未カバー領域が見える化されている）

---

## 8. レビュー結果の出し方（推奨フォーマット）

* 重要度（例）:

  * **Blocker**: 運用で致命的（データ破壊、制御不能、セキュリティ事故、復旧困難）
  * **High**: 高確率で障害/重大劣化
  * **Medium**: 仕様逸脱/保守性劣化/将来問題化
  * **Low / Nit**: 改善提案・スタイル

* 1件ごとの記載例:

  * タイトル:
  * 重要度:
  * 対象（リンク）:
  * 事象:
  * 影響:
  * 再現条件（あれば）:
  * 改善案（あれば）:

---

## 9. 補足（レビュー観点の前提）

* 本レビューは「実装の正しさ」だけでなく、**運用・障害時の振る舞い**（タイムアウト、解放、滞留、再送、監視）を重視します。
* 指摘は「あるべき論」だけでなく、**現状の仕様/制約の中での最短改善案**も歓迎です。

---

以上

```


```
