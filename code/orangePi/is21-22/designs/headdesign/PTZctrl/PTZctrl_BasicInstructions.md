# PTZctrl_BasicInstructions
## 概要
- PTZ対応カメラのクリックモーダルでの操作を可能にする。
- code/orangePi/is21-22/designs/headdesign/PTZctrl/PTZctrl_basicdesign.mdを参照し整合性に注意しAccessAbsorberなどとの連携に注意する。
- The_golden_rules.mdのルールに沿って確実に実装を行う。
- そのほかこの実装で既知の改修点、修正点にも対応する。

## 既知の問題
- クリックモーダルで表示される拡大イメージを現在の130%を目処にUI表示を大きくする。(単純に拡大した感が薄い)→参照code/orangePi/is21-22/designs/headdesign/PTZctrl/screenshot/img1.png
- code/orangePi/is21-22/designs/headdesign/PTZctrl/screenshot/img3.pngのカメラ設定で画像・映像の回転が保持されてこの設定画面上は適用されているがカメラタイル、サジェストビューで適用されない。
- code/orangePi/is21-22/designs/headdesign/PTZctrl/screenshot/img1.pngの画像のように巡回検知で同じカメラを検知された時にサジェストビュー上でそのサジェストを上位に移動する、同一カメラの映像はサジェストには1つしか許可されないという仕様が守られていない。これは長時間動作時に発生しがち。
- サジェストビューは最大3枚で以降に増えた場合は最古のサジェストが押し出されて表示から消える仕様であったはずだがcode/orangePi/is21-22/designs/headdesign/PTZctrl/screenshot/img1.pngで4つ表示されている。サジェストビュー枚数制限はtapoシリーズなどの多重アクセスに弱いカメラデバイスなどとの連携上非常に大事な機能。
-  サジェストビューが設定された`onairTime`に基づいて再生時間が決まるはずだがcode/orangePi/is21-22/designs/headdesign/PTZctrl/screenshot/img1.pngで守られていない時がある。サジェストビュー時間制限はtapoシリーズなどの多重アクセスに弱いカメラデバイスなどとの連携上非常に大事な機能。
- そのほかAccessAbsorberでサジェストビューに入っているカメラをカメラタイルからクリック→モーダル表示した際にクリックモーダル側が優先され、そのカメラがクリックモーダルでストリームされている間はサジェストされてもストリームされずに閉じる(サジェストに出てくるが重複ストリームの禁止などで閉じるというメッセージを表示しフィードバック、"なんかよくわからないけど繋がらない"といった体感を与えない)

## PTZctrlに関する仕様の重要な追加仕様
1. カメラ設定モーダルに"PTZctrlを無効にする"チェックボックスを設け、カメラのDBにもこのフィールドを追加、このチェックが入っている場合にクリックモーダルにPTZコントローラーを表示しない。これは監視スタッフに安易にPTZを操作させないという程度のものです。厳密な制限の意図はありませんのでパスワードなどの制限は不要です。
   デフォルトはOFFです、PTZ機能のないカメラではこのチェック欄はグレーアウトです。
2. コントロールの明確なフィードバック、ブラウザ操作系でよくあるフィードバックが薄くてどちらの向きに操作しているかわからないという状況にならないように注意が必要。カーソル操作のユーザーフィードバック、"←pan left"などの表示をカーソル近くに一時的に表示するなど必要です
3. 既知の問題で触れたカメラ画像/映像の回転にコントローラが追随する必要があります。’