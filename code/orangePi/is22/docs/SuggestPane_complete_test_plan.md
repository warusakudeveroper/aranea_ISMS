# SuggestPane go2rtc動画再生 完全テスト計画書

## 文書情報
| 項目 | 内容 |
|------|------|
| 作成日 | 2026-01-04 |
| 設計準拠 | SuggestPane_go2rtc_final_spec.md |
| ルール準拠 | is22_Camserver実装指示.md |
| ステータス | 未実施 |

---

## 1. テスト対象概要

### 1.1 対象機能
AI検知イベント発生時に該当カメラの動画をgo2rtc経由でリアルタイム再生するSuggestPaneコンポーネント

### 1.2 設計仕様書参照
- `code/orangePi/is22/docs/SuggestPane_go2rtc_final_spec.md`

---

## 2. テストカテゴリ

| カテゴリID | カテゴリ名 | 項目数 |
|------------|------------|--------|
| CAT-01 | レイアウト検証 | 8 |
| CAT-02 | 動画再生機能 | 12 |
| CAT-03 | onairtime管理 | 7 |
| CAT-04 | カメラ追加・削除フロー | 10 |
| CAT-05 | アニメーション検証 | 6 |
| CAT-06 | オンエアハイライト連携 | 4 |
| CAT-07 | 独立動作要件 | 4 |
| CAT-08 | パフォーマンス計測 | 6 |
| CAT-09 | バックエンド整合性 | 5 |
| CAT-10 | ストレステスト | 5 |
| **合計** | | **67** |

---

## 3. テスト項目詳細

### CAT-01: レイアウト検証

| ID | テスト項目 | 期待結果 | 検証方法 | 合否 | エビデンス |
|----|-----------|----------|----------|------|------------|
| L-01 | ペイン幅 | 画面横幅の30% | Chrome DevTools計測 | - | - |
| L-02 | ペイン高さ | 画面高さ - ヘッダー高さ | Chrome DevTools計測 | - | - |
| L-03 | 最大カメラスロット数 | 3台同時表示可能 | 目視確認 | - | - |
| L-04 | 各スロット高さ | ペイン高さの1/3 | Chrome DevTools計測 | - | - |
| L-05 | スロット幅 | 100%（ペイン幅いっぱい） | Chrome DevTools計測 | - | - |
| L-06 | 角丸 | なし（border-radius: 0） | CSS検査 | - | - |
| L-07 | スロット間隔 | 0〜2px | Chrome DevTools計測 | - | - |
| L-08 | 上下配置 | 上寄せ（flexbox start） | CSS検査 | - | - |

### CAT-02: 動画再生機能

| ID | テスト項目 | 期待結果 | 検証方法 | 合否 | エビデンス |
|----|-----------|----------|----------|------|------------|
| V-01 | go2rtc MSE接続 | WebSocket接続成功 | コンソールログ確認 | - | - |
| V-02 | ストリーム登録 | PUT /api/streams 成功(200/201) | Network監視 | - | - |
| V-03 | 動画再生開始 | video要素でplaying状態 | video.readyState確認 | - | - |
| V-04 | object-fit | cover適用（見切れOK） | CSS検査 | - | - |
| V-05 | 動画領域 | スロット全体（full-bleed） | 目視確認 | - | - |
| V-06 | 自動再生 | 再生ボタンなしで自動開始 | 動作確認 | - | - |
| V-07 | ミュート状態 | デフォルトでmuted=true | video属性確認 | - | - |
| V-08 | エラー時フォールバック | 接続エラー表示 + 再試行ボタン | 目視確認 | - | - |
| V-09 | severity>0フィルタ | severity=0イベントは非表示 | 動作確認 | - | - |
| V-10 | rtsp_main存在確認 | rtsp_mainがないカメラは非表示 | 動作確認 | - | - |
| V-11 | WebSocket切断処理 | 終了時に適切に切断 | Network監視 | - | - |
| V-12 | 複数カメラ同時再生 | 3台同時に動画再生 | 目視確認 | - | - |

### CAT-03: onairtime管理

| ID | テスト項目 | 期待結果 | 検証方法 | 合否 | エビデンス |
|----|-----------|----------|----------|------|------------|
| O-01 | デフォルト値 | 180秒 | localStorage確認 | - | - |
| O-02 | 設定保存 | localStorageに保存 | Storage確認 | - | - |
| O-03 | 設定読み込み | 起動時にlocalStorageから読み込み | コンソールログ | - | - |
| O-04 | カウントダウン動作 | lastEventAtから経過時間計測 | ログ確認 | - | - |
| O-05 | 延長ロジック | 同一カメラ再検知でlastEventAt更新 | ログ確認 | - | - |
| O-06 | 終了判定 | elapsed >= onairtimeで終了 | 動作確認 | - | - |
| O-07 | SettingsModal UI | 30-600秒の範囲で設定可能 | UI操作確認 | - | - |

### CAT-04: カメラ追加・削除フロー

| ID | テスト項目 | 期待結果 | 検証方法 | 合否 | エビデンス |
|----|-----------|----------|----------|------|------------|
| F-01 | 新規カメラ挿入 | 最上部に挿入 | 目視確認 | - | - |
| F-02 | 既存カメラ押し下げ | 既存は下にスライド | 目視確認 | - | - |
| F-03 | 4台目検知時 | 最古を削除して新規追加 | 動作確認 | - | - |
| F-04 | 同一カメラ再検知 | 延長のみ（重複挿入なし） | 動作確認 | - | - |
| F-05 | 順序変更（延長時） | 最新イベント順に並び替え | 動作確認 | - | - |
| F-06 | onairtime終了時削除 | 該当カメラのみ削除 | 動作確認 | - | - |
| F-07 | 複数同時終了 | 順次削除処理 | 動作確認 | - | - |
| F-08 | イベントなし状態 | プレースホルダー表示 | 目視確認 | - | - |
| F-09 | WebSocketイベント連携 | event_logからの検知 | Network監視 | - | - |
| F-10 | go2rtcストリーム登録 | 追加時に自動登録 | API監視 | - | - |

### CAT-05: アニメーション検証

| ID | テスト項目 | 期待結果 | 検証方法 | 合否 | エビデンス |
|----|-----------|----------|----------|------|------------|
| A-01 | 挿入アニメーション方向 | 上から下へスライドイン | 目視確認 | - | - |
| A-02 | 挿入アニメーション時間 | 300ms | Performance計測 | - | - |
| A-03 | 削除アニメーション方向 | 左へスライドアウト | 目視確認 | - | - |
| A-04 | 削除アニメーション時間 | 300ms | Performance計測 | - | - |
| A-05 | 位置移動アニメーション | 300ms ease-out | Performance計測 | - | - |
| A-06 | アニメーション中の動画 | 再生継続 | 目視確認 | - | - |

### CAT-06: オンエアハイライト連携

| ID | テスト項目 | 期待結果 | 検証方法 | 合否 | エビデンス |
|----|-----------|----------|----------|------|------------|
| H-01 | ハイライト表示 | 再生中カメラに黄色枠 | 目視確認 | - | - |
| H-02 | ハイライトスタイル | ring-2 ring-yellow-500 | CSS検査 | - | - |
| H-03 | 終了時ハイライト解除 | 枠が消える | 目視確認 | - | - |
| H-04 | 複数カメラハイライト | 3台同時にハイライト可能 | 目視確認 | - | - |

### CAT-07: 独立動作要件

| ID | テスト項目 | 期待結果 | 検証方法 | 合否 | エビデンス |
|----|-----------|----------|----------|------|------------|
| I-01 | タイルクリックモーダル中 | サジェスト再生継続 | 動作確認 | - | - |
| I-02 | 設定モーダル中 | サジェスト再生継続 | 動作確認 | - | - |
| I-03 | イベントログクリック中 | サジェスト再生継続 | 動作確認 | - | - |
| I-04 | 停止ボタン不在 | 手動停止不可（自動終了のみ） | UI確認 | - | - |

### CAT-08: パフォーマンス計測

| ID | テスト項目 | 期待基準 | 検証方法 | 計測値 | 合否 |
|----|-----------|----------|----------|--------|------|
| P-01 | 初回動画表示遅延 | < 3秒 | Performance API | - | - |
| P-02 | CPU使用率（3カメラ再生時） | < 50% | Chrome DevTools | - | - |
| P-03 | メモリ使用量 | < 500MB増加 | Chrome DevTools | - | - |
| P-04 | WebSocket接続数 | 最大3本 | Network監視 | - | - |
| P-05 | フレームレート | > 15fps | video統計 | - | - |
| P-06 | イベント処理遅延 | < 500ms | タイムスタンプ比較 | - | - |

### CAT-09: バックエンド整合性

| ID | テスト項目 | 期待結果 | 検証方法 | 合否 | エビデンス |
|----|-----------|----------|----------|------|------------|
| B-01 | go2rtcストリーム状態 | API /api/streamsで確認可能 | curl確認 | - | - |
| B-02 | is21連携 | severity計算が正しい | バックエンドログ | - | - |
| B-03 | WebSocket event_log | イベントが正しく配信 | Network監視 | - | - |
| B-04 | RTSPストリーム疎通 | カメラに接続可能 | go2rtcログ | - | - |
| B-05 | エラーログ整合 | フロント/バックエンド整合 | ログ比較 | - | - |

### CAT-10: ストレステスト

| ID | テスト項目 | 期待結果 | 検証方法 | 合否 | エビデンス |
|----|-----------|----------|----------|------|------------|
| S-01 | 連続イベント処理 | 10件/分で安定動作 | 負荷テスト | - | - |
| S-02 | 長時間再生安定性 | 30分以上安定 | 長時間監視 | - | - |
| S-03 | 頻繁なカメラ切替 | 20回切替で安定 | 連続操作 | - | - |
| S-04 | ネットワーク断続 | 再接続処理正常 | ネットワーク遮断 | - | - |
| S-05 | ブラウザリロード | 状態復元正常 | リロードテスト | - | - |

---

## 4. テスト環境

### 4.1 サーバー環境
| 項目 | 値 |
|------|-----|
| サーバーIP | 192.168.125.246 |
| フロントエンドポート | 3000 |
| バックエンドポート | 8080 |
| go2rtcポート | 1984 |
| ユーザー | mijeosadmin |

### 4.2 テスト用カメラ
| ネットワーク | 認証情報 |
|--------------|----------|
| 192.168.125.0/24 | halecam / hale0083@ |
| 192.168.126.0/24 | halecam / hale0083@ |

### 4.3 クライアント環境
| 項目 | 値 |
|------|-----|
| ブラウザ | Google Chrome (最新版) |
| 検証ツール | Chrome DevTools, MCP Browser Automation |

---

## 5. テスト実施手順

### 5.1 事前準備
1. サーバー(192.168.125.246)の稼働確認
2. go2rtcサービスの稼働確認
3. is21 AIサーバー(192.168.3.240)との疎通確認
4. テスト用カメラの疎通確認
5. Chrome DevToolsの準備

### 5.2 実施順序
1. CAT-01: レイアウト検証
2. CAT-02: 動画再生機能
3. CAT-03: onairtime管理
4. CAT-04: カメラ追加・削除フロー
5. CAT-05: アニメーション検証
6. CAT-06: オンエアハイライト連携
7. CAT-07: 独立動作要件
8. CAT-08: パフォーマンス計測
9. CAT-09: バックエンド整合性
10. CAT-10: ストレステスト

### 5.3 エビデンス取得
- 各テスト項目でスクリーンショット取得
- コンソールログの保存
- Network通信ログの保存
- パフォーマンス計測結果の記録

---

## 6. 合否判定基準

### 6.1 項目レベル
- **合格**: 期待結果を完全に満たす
- **不合格**: 期待結果を満たさない、またはエラー発生

### 6.2 全体レベル
- **完全合格**: 全67項目が合格
- **条件付き合格**: 65項目以上合格かつ重大項目に不合格なし
- **不合格**: 上記以外

### 6.3 重大項目（必須合格）
- V-01, V-02, V-03 (動画再生基本機能)
- V-09 (severity>0フィルタ)
- F-01, F-06 (カメラ追加・削除)
- H-01 (オンエアハイライト)

---

## 7. 障害対応

### 7.1 不合格時の対応
1. 原因調査（コード、設計、環境）
2. 修正実施
3. 再テスト
4. 結果記録

### 7.2 報告形式
不合格項目については以下を記録:
- テスト項目ID
- 実際の結果
- エラーログ/スクリーンショット
- 原因分析
- 修正内容
- 再テスト結果

---

## 8. 更新履歴

| 日付 | 内容 | 担当 |
|------|------|------|
| 2026-01-04 | 初版作成 | Claude |

---

## 9. MECE確認

本テスト計画は以下の観点でMECE性を確認:

- **漏れなし**: 設計仕様書の全項目をカバー
- **重複なし**: 各テスト項目は独立した検証観点を持つ
- **カテゴリ分類**: 機能/非機能要件を網羅的に分類

## 10. アンアンビギュアス宣言

本テスト計画書は設計仕様書「SuggestPane_go2rtc_final_spec.md」に基づき、全ての検証項目を明確に定義しています。曖昧な判定基準は存在せず、各項目の合否は客観的に判断可能です。
